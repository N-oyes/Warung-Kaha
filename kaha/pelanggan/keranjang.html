<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Keranjang - Warung Makan Kaha</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /* Style sama seperti sebelumnya */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      max-width: 1920px;
      min-height: 1100px;
      margin: 0 auto;
      font-family: 'Inter', sans-serif;
      color: #2d2d2d;
      font-size: 18px;
      line-height: 1.5;
      display: flex;
      flex-direction: column;
    }
    header {
      background-color:#F9D4B4;
      color: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      padding: 16px 24px;
    }
      .orange-title {
    color: #f97316;
  }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .nav-links {
      display: flex;
      gap: 24px;
    }
    .nav-links a:hover {
      color: #f97316;
    }
    .nav-links a {
      color: #000;
      text-decoration: none;
      font-weight: 500;
    }
    .breadcrumb {
      padding: 8px 24px;
      font-size: 18px;
      color: #666;
      display: flex;
      justify-content: space-between;
    }
    main {
      display: grid;
      grid-template-columns: 1fr;
      gap: 32px;
      padding: 40px 24px;
      flex-grow: 1;
    }
    @media (min-width: 768px) {
      main {
        grid-template-columns: 1fr 1fr;
      }
    }
    section {
      background-color: white;
      border-radius: 8px;
      padding: 24px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #fff;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      margin-bottom: 16px;
    }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-bottom: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-family: inherit;
    }
    button {
      background-color: #13824F;
      color: white;
      padding: 12px;
      font-size: 18px;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .minus-btn { background-color: #fee2e2; color: #b91c1c; min-width: 36px; padding: 8px; font-weight: 600; }
    .plus-btn { background-color: #d1fae5; color: #065f46; min-width: 36px; padding: 8px; font-weight: 600; }
    .remove-btn { background-color: #e5e7eb; color: #374151; min-width: 36px; padding: 8px; font-weight: 600; }
    footer {
      background-color: #0c0a3a;
      color: white;
      text-align: center;
      padding: 24px;
      font-size: 18px;
      margin-top: auto;
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <h1 class="orange-title">üçΩÔ∏è Warung Makan Kaha</h1>
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="menu.html">Katalog Menu</a>
      </div>
    </nav>
  </header>

  <div class="breadcrumb">
    <span><i class="fas fa-shopping-basket"></i> Keranjang</span>
    <span>Home / Keranjang</span>
  </div>

  <main>
    <section>
      <h2 class="orange-title">Daftar Pesanan</h2>
      <div id="cart-container"></div>
    </section>

    <section>
     <h3 class="orange-title"><i class="fas fa-user"></i> Data Pembeli</h3>
      <form id="checkout-form">
        <label for="nama">Nama Lengkap</label>
        <input type="text" id="nama" required>
        <label for="telepon">Nomor Telepon</label>
        <input type="tel" id="telepon" required>
        <label for="alamat">Alamat Lengkap</label>
        <textarea id="alamat" rows="3" required></textarea>
        <label for="catatan">Catatan Tambahan</label>
        <textarea id="catatan" rows="2"></textarea>
        <label for="pembayaran">Metode Pembayaran</label>
        <select id="pembayaran" required>
          <option value="">-- Pilih Metode --</option>
          <option value="cod">Bayar di Tempat (COD)</option>
          <option value="transfer">Transfer Bank</option>
        </select>

        <div id="bank-wrapper" style="display: none;">
          <label for="bank">Pilih Bank Tujuan</label>
          <select id="bank">
            <option value="">-- Pilih Bank --</option>
            <option value="BNI">BNI - 88081234567890</option>
            <option value="BCA">BCA - 700120012345678</option>
            <option value="Mandiri">Mandiri - 9001234567890123</option>
          </select>
        </div>

        <label for="pengiriman">Metode Pengiriman</label>
        <select id="pengiriman" required>
          <option value="">-- Pilih Pengiriman --</option>
          <option value="antar">Antar ke Alamat</option>
          <option value="ambil">Ambil Sendiri</option>
        </select>

        <div id="ongkir-wrapper" style="display: none;">
          <label>Ongkos Kirim</label>
          <p id="ongkir-text">Rp 0</p>
        </div>

        <div class="total">
          <span>Total:</span>
          <span id="total-price">Rp 0</span>
        </div>

        <button type="submit" id="checkout-btn" disabled>Kirim Pesanan</button>
      </form>
    </section>
  </main>

  <footer>
    <p>Warung Makan Kaha</p>
    <p>Alamat:Jl. Rajawali Raya Ganjuran No.33, RT./RW/RW.03/64, Manukan, Condongcatur, Kec. Depok, Kabupaten Sleman, Daerah Istimewa Yogyakarta 55283</p>
    <p>No Telepon: 085202430918</p>
    <i class="fab fa-instagram"></i>
    <i class="fab fa-facebook-f"></i>
    <p>¬© 2025 Warung Makan Kaha. All Rights Reserved.</p>
  </footer>

  <script>
    function renderCart() {
  const cartContainer = document.getElementById("cart-container");
  let cartItems = JSON.parse(localStorage.getItem("cart")) || [];
  let total = 0;

  if (cartItems.length === 0) {
    cartContainer.innerHTML = `<p class="empty-cart">Keranjang kamu kosong üò¢</p>`;
    document.getElementById("total-price").textContent = "Rp 0";
    document.getElementById("checkout-btn").disabled = true;
    return;
  }

  cartContainer.innerHTML = "";

  cartItems.forEach((item, index) => {
    const card = document.createElement("div");
    card.className = "cart-item";
    card.style.display = "flex";
    card.style.justifyContent = "space-between";
    card.style.alignItems = "center";
    card.style.padding = "12px";
    card.style.borderBottom = "1px solid #ddd";

    const info = document.createElement("div");
    info.innerHTML = `<strong>${item.name}</strong><p>Rp ${(item.price * item.quantity).toLocaleString("id-ID")}</p>`;

    const controls = document.createElement("div");
    controls.style.display = "flex";
    controls.style.gap = "10px";
    controls.style.alignItems = "center";

    const minusBtn = document.createElement("button");
    minusBtn.className = "minus-btn";
    minusBtn.textContent = "-";
    minusBtn.style.padding = "4px 8px";
    minusBtn.onclick = () => {
      if (item.quantity > 1) {
        item.quantity -= 1;
        updateCart(cartItems);
      }
    };

    const qty = document.createElement("span");
    qty.textContent = item.quantity;
    qty.style.minWidth = "24px";
    qty.style.textAlign = "center";

    const plusBtn = document.createElement("button");
    plusBtn.className = "plus-btn";
    plusBtn.textContent = "+";
    plusBtn.style.padding = "4px 8px";
    plusBtn.onclick = () => {
      item.quantity += 1;
      updateCart(cartItems);
    };

    const removeBtn = document.createElement("button");
    removeBtn.className = "remove-btn";
    removeBtn.textContent = "üóëÔ∏è";
    removeBtn.title = "Hapus item";
    removeBtn.style.padding = "4px 8px";
    removeBtn.onclick = () => {
      cartItems.splice(index, 1);
      updateCart(cartItems);
    };

    controls.append(minusBtn, qty, plusBtn, removeBtn);
    card.append(info, controls);
    cartContainer.appendChild(card);

    total += item.price * item.quantity;
  });

  document.getElementById("total-price").textContent = `Rp ${total.toLocaleString("id-ID")}`;
  document.getElementById("checkout-btn").disabled = false;
}

    function updateCart(cartItems) {
      localStorage.setItem("cart", JSON.stringify(cartItems));
      renderCart();
      updateTotalHarga();
    }

    let ongkir = 0;
    const pembayaranEl = document.getElementById("pembayaran");
    const bankWrapper = document.getElementById("bank-wrapper");
    const bankEl = document.getElementById("bank");
    const pengirimanEl = document.getElementById("pengiriman");
    const ongkirWrapper = document.getElementById("ongkir-wrapper");
    const ongkirText = document.getElementById("ongkir-text");

    pembayaranEl.addEventListener("change", () => {
      if (pembayaranEl.value === "transfer") {
        bankWrapper.style.display = "block";
        bankEl.required = true;
      } else {
        bankWrapper.style.display = "none";
        bankEl.required = false;
      }
    });

    pengirimanEl.addEventListener("change", () => {
      if (pengirimanEl.value === "antar") {
        ongkir = 15000;
        ongkirWrapper.style.display = "block";
        ongkirText.textContent = `Rp ${ongkir.toLocaleString("id-ID")}`;
      } else {
        ongkir = 0;
        ongkirWrapper.style.display = "none";
        ongkirText.textContent = "Rp 0";
      }
      updateTotalHarga();
    });

    function updateTotalHarga() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      let total = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
      total += ongkir;
      document.getElementById("total-price").textContent = `Rp ${total.toLocaleString("id-ID")}`;
    }

    document.getElementById("checkout-form").addEventListener("submit", function(e) {
      e.preventDefault();

      const nama = document.getElementById("nama").value;
      const telepon = document.getElementById("telepon").value;
      const alamat = document.getElementById("alamat").value;
      const catatan = document.getElementById("catatan").value;
      const pembayaran = pembayaranEl.value;
      const pengiriman = pengirimanEl.value;
      const bank = bankEl.value;
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      let total = cart.reduce((acc, item) => acc + item.price * item.quantity, 0) + ongkir;

      if (!nama || !telepon || !alamat || !pembayaran || !pengiriman || (pembayaran === "transfer" && !bank)) {
        alert("Lengkapi semua data terlebih dahulu.");
        return;
      }

          const pesanan = {
      id: Date.now(),
      nama,
      telepon,
      alamat,
      catatan,
      pembayaran,
      bank: pembayaran === "transfer" ? bank : null,
      pengiriman,
      ongkir,
      total,
      items: cart,
      status: "Belum Diverifikasi"  // ‚¨ÖÔ∏è Tambahan ini
    };

      const riwayat = JSON.parse(localStorage.getItem("riwayat_pesanan")) || [];
      riwayat.push(pesanan);
      localStorage.setItem("riwayat_pesanan", JSON.stringify(riwayat));
      localStorage.removeItem("cart");

      let invoice = `Total Bayar: Rp ${total.toLocaleString("id-ID")}\n`;
      if (pembayaran === "transfer") {
        const bankInfo = bankEl.options[bankEl.selectedIndex].text;
        invoice += `Silakan transfer ke:\n${bankInfo}`;
      } else {
        invoice += `Metode Pembayaran: ${pembayaran.toUpperCase()}`;
      }

      Swal.fire({
  title: 'Pesanan Berhasil!',
  html: `
    <div style="text-align: left;">
      <p><strong>Total Bayar:</strong> Rp ${total.toLocaleString("id-ID")}</p>
      ${pembayaran === "transfer"
        ? `<p><strong>Transfer ke:</strong><br>${bankEl.options[bankEl.selectedIndex].text}</p>`
        : `<p><strong>Metode Pembayaran:</strong> ${pembayaran.toUpperCase()}</p>`}
      <p><strong>Terima kasih, ${nama}! üòä</strong></p>
    </div>
  `,
  icon: 'success',
  confirmButtonText: 'OK',
  confirmButtonColor: '#4f46e5'
}).then(() => {
  window.location.href = "keranjang.html";
});
    });

    window.addEventListener('DOMContentLoaded', () => {
      renderCart();
      updateTotalHarga();
    });
  </script>
</body>
</html>
